<body>
  <div class="container">
    <h2>📋 Your Monthly Diet Plan</h2>

    <!-- 🎉 Message -->
    <div *ngIf="showCongratulations" class="congrats-message">
      🎉 Congratulations! You've completed your entire diet plan! 🎉
    </div>

    <!-- ✅ Show regenerate button if user has already reviewed -->
    <div
      *ngIf="showCongratulations && userInfo.hasReviewedDiet"
      class="text-center mt-3"
    >
      <button class="btn-download" (click)="regeneratePlan()">
        ♻️ Generate New Diet Plan
      </button>
      <button class="btn-reset" (click)="resetPlan()">🔄 Restart Plan</button>
    </div>

    <!-- ✍️ Show review box if user hasn't reviewed -->
    <div
      *ngIf="showCongratulations && !userInfo.hasReviewedDiet"
      class="review-box"
    >
      <h4>📝 Share Your Feedback</h4>

      <label for="weight">⚖️ Updated Weight (kg):</label>
      <input
        id="weight"
        type="number"
        [(ngModel)]="feedbackWeight"
        class="form-input"
      />

      <label for="review">⭐ Short Review:</label>
      <textarea
        id="review"
        [(ngModel)]="feedbackText"
        rows="3"
        class="form-textarea"
        placeholder="How was your experience with the plan?"
      ></textarea>

      <button class="btn-submit-review" (click)="submitDietReview()">
        ✅ Submit Review
      </button>
    </div>

    <div class="progress-container">
      <p>
        Progress: {{ completedDays }}/{{ totalDays }} Days Completed ({{
          progressPercent
        }}%) ✅
      </p>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercent"></div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="text-center mt-4 action-buttons">
      <button class="btn-download" (click)="downloadExcel()">
        📥 Download as Excel
      </button>
    </div>

    <div class="week-grid">
      <div
        *ngFor="let week of generatedPlans; let wi = index"
        class="week-card"
        [ngClass]="{
          'grid-half': wi < 2,
          'full-width': wi >= 2 && showAllWeeks,
          hidden: wi >= 2 && !showAllWeeks
        }"
      >
        <h5>📅 Week {{ wi + 1 }}</h5>

        <div
          *ngFor="let day of week.days; let di = index"
          class="day-block"
          [ngClass]="{ 'day-finished': day.finished }"
        >
          <h6>🍽️ Day {{ di + 1 }}</h6>

          <ul>
            <li><strong>Breakfast:</strong> {{ day.breakfast }}</li>
            <li><strong>Lunch:</strong> {{ day.lunch }}</li>
            <li><strong>Dinner:</strong> {{ day.dinner }}</li>
            <li *ngIf="day.snack"><strong>Snack:</strong> {{ day.snack }}</li>
          </ul>

          <div class="day-actions">
            <button
              *ngIf="!day.finished"
              class="btn-finish"
              (click)="finishDay(wi, di)"
            >
              ✅ Mark as Finished
            </button>
            <div *ngIf="day.finished" class="finished-label">🎉 Completed!</div>
          </div>
          <!-- 🛠️ Replace Button -->
          <div *ngIf="userInfo?.isSubscribed" class="replace-container">
            <button
              class="btn-replace-toggle"
              (click)="toggleReplaceMenu(wi, di)"
            >
              🔧 Replace a Meal
            </button>

            <div
              class="replace-options"
              *ngIf="toggledReplaceMenus[wi + '-' + di]"
            >
              <button (click)="replaceMeal(wi, di, 'breakfast')">
                🍳 Replace Breakfast
              </button>
              <button (click)="replaceMeal(wi, di, 'lunch')">
                🥗 Replace Lunch
              </button>
              <button (click)="replaceMeal(wi, di, 'dinner')">
                🍽️ Replace Dinner
              </button>
              <button *ngIf="day.snack" (click)="replaceMeal(wi, di, 'snack')">
                🍪 Replace Snack
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toggle Button -->
    <div class="text-center mt-4">
      <button class="btn-toggle" (click)="showAllWeeks = !showAllWeeks">
        {{ showAllWeeks ? "🔽 Show Less" : "🔼 Show All Weeks" }}
      </button>
    </div>
  </div>
    <button class="scroll-up-btn" (click)="scrollToTop()" title="Scroll to top">
    ↑
  </button>
  <button
    class="scroll-down-btn"
    (click)="scrollToBottom()"
    title="Scroll to bottom"
  >
    ↓
  </button>
</body>
